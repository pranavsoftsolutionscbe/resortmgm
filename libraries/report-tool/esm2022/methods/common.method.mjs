export function joinPaths(...paths) {
    return paths.join("/");
}
export function filter(array, filterKey, value) {
    return array.filter((f) => (value ? f[filterKey] === value : f[filterKey]));
}
export function filterByMenu(array, keys, value) {
    const [childKey, filterKey] = keys;
    if (value && value.length) {
        const filterData = (data, predicate) => {
            return !!!data
                ? null
                : data.reduce((list, entry) => {
                    let clone = null;
                    if (predicate(entry)) {
                        // if the object matches the filter, clone it as it is
                        clone = Object.assign({}, entry);
                    }
                    else if (entry[childKey] != null) {
                        // if the object has childrens, filter the list of children
                        const children = filterData(entry[childKey], predicate);
                        if (children.length > 0) {
                            // if any of the children matches, clone the parent object, overwrite
                            // the children list with the filtered list
                            clone = Object.assign({}, entry, { children: [...children] });
                        }
                    }
                    // if there's a cloned object, push it to the output list
                    // tslint:disable-next-line: no-unused-expression
                    clone && list.push(clone);
                    return list;
                }, []);
        };
        return filterData(array, (item) => {
            return (item[filterKey] &&
                item[filterKey]
                    .toString()
                    .toLowerCase()
                    .includes(value.toString().toLowerCase()));
        });
    }
    return array;
}
export function parseValue(v) {
    // extract number (defaults to 0 if not present)
    const n = +(v.match(/\d+$/) || [0])[0];
    const str = v.replace(n.toString(), ""); // extract string part
    return [str, n];
}
export function sort(array, key, isCompare = false) {
    const compare = (x, y) => {
        if (isCompare && typeof x === "string" && typeof y === "string") {
            const a = parseValue(x);
            const b = parseValue(y);
            const result = a[0].localeCompare(b[0]);
            return result === 0 ? a[1] - b[1] : result;
        }
        else if (typeof x === "boolean" && typeof y === "boolean") {
            return x && !y ? -1 : x && y ? 0 : 1;
        }
        return x < y ? -1 : x > y ? 1 : 0;
    };
    return array.sort((a, b) => {
        const x = key
            ? typeof a[key] === "string"
                ? a[key].toLowerCase()
                : a[key]
            : a;
        const y = key
            ? typeof b[key] === "string"
                ? b[key].toLowerCase()
                : b[key]
            : b;
        return compare(x, y);
    });
}
export function multiSort(array, keys, isCompare = false) {
    const compare = (x, y) => {
        if (isCompare && typeof x === "string" && typeof y === "string") {
            const a = parseValue(x);
            const b = parseValue(y);
            const result = a[0].localeCompare(b[0]);
            return result === 0 ? a[1] - b[1] : result;
        }
        else if (typeof x === "boolean" && typeof y === "boolean") {
            return x === y ? 0 : x ? -1 : 1;
        }
        return x < y ? -1 : x > y ? 1 : 0;
    };
    let returnArray = array;
    keys.forEach((key) => {
        returnArray = returnArray.sort((a, b) => {
            const x = typeof a[key] === "string" ? a[key].toLowerCase() : a[key];
            const y = typeof b[key] === "string" ? b[key].toLowerCase() : b[key];
            return compare(x, y);
        });
    });
    return returnArray;
}
export function groupBy(array, keys) {
    const [parentKey, childKey, sortKey] = keys;
    let parentList = array.filter((f) => !f[parentKey]);
    const childList = filter(array, parentKey);
    parentList.forEach((parent) => {
        const items = filter(childList, parentKey, parent[childKey]);
        if (sortKey) {
            if (typeof sortKey === "string") {
                parent.items = sort(items, sortKey);
            }
            else {
                parent.items = multiSort(items, sortKey);
            }
        }
        else {
            parent.items = items;
        }
    });
    parentList = sortKey ? sort(parentList, sortKey) : parentList;
    return [...parentList];
}
export function between(value, min, max) {
    return value >= min && value <= max;
}
export function percentage(value, total) {
    return Math.round((value * 100) / total);
}
export function isJson(str) {
    try {
        JSON.parse(str);
    }
    catch (e) {
        return false;
    }
    return true;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLm1ldGhvZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL3JlcG9ydC10b29sL21ldGhvZHMvY29tbW9uLm1ldGhvZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLFVBQVUsU0FBUyxDQUFDLEdBQUcsS0FBWTtJQUN2QyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDekIsQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUksS0FBVSxFQUFFLFNBQWlCLEVBQUUsS0FBVztJQUNsRSxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25GLENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLEtBQVksRUFBRSxJQUFjLEVBQUUsS0FBVTtJQUNuRSxNQUFNLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUNuQyxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFO1FBQ3pCLE1BQU0sVUFBVSxHQUFHLENBQUMsSUFBVyxFQUFFLFNBQWtELEVBQUUsRUFBRTtZQUNyRixPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQ1osQ0FBQyxDQUFDLElBQUk7Z0JBQ04sQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7b0JBQzFCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztvQkFDakIsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7d0JBQ3BCLHNEQUFzRDt3QkFDdEQsS0FBSyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFB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LEdBQUcsVUFBVSxDQUFDLENBQUM7QUFDekIsQ0FBQztBQUVELE1BQU0sVUFBVSxPQUFPLENBQUMsS0FBYSxFQUFFLEdBQVcsRUFBRSxHQUFXO0lBQzdELE9BQU8sS0FBSyxJQUFJLEdBQUcsSUFBSSxLQUFLLElBQUksR0FBRyxDQUFDO0FBQ3RDLENBQUM7QUFFRCxNQUFNLFVBQVUsVUFBVSxDQUFDLEtBQWEsRUFBRSxLQUFhO0lBQ3JELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUMzQyxDQUFDO0FBRUQsTUFBTSxVQUFVLE1BQU0sQ0FBQyxHQUFXO0lBQ2hDLElBQUk7UUFDRixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ2pCO0lBQUMsT0FBTyxDQUFDLEVBQUU7UUFDVixPQUFPLEtBQUssQ0FBQztLQUNkO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIGpvaW5QYXRocyguLi5wYXRoczogYW55W10pOiBzdHJpbmcge1xyXG4gIHJldHVybiBwYXRocy5qb2luKFwiL1wiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlcjxUPihhcnJheTogVFtdLCBmaWx0ZXJLZXk6IHN0cmluZywgdmFsdWU/OiBhbnkpOiBUW10ge1xyXG4gIHJldHVybiBhcnJheS5maWx0ZXIoKGY6IGFueSkgPT4gKHZhbHVlID8gZltmaWx0ZXJLZXldID09PSB2YWx1ZSA6IGZbZmlsdGVyS2V5XSkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyQnlNZW51KGFycmF5OiBhbnlbXSwga2V5czogc3RyaW5nW10sIHZhbHVlOiBhbnkpOiBhbnlbXSB7XHJcbiAgY29uc3QgW2NoaWxkS2V5LCBmaWx0ZXJLZXldID0ga2V5cztcclxuICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoKSB7XHJcbiAgICBjb25zdCBmaWx0ZXJEYXRhID0gKGRhdGE6IGFueVtdLCBwcmVkaWNhdGU6IHsgKGl0ZW06IGFueSk6IGFueTsgKGFyZzA6IGFueSk6IGFueTsgfSkgPT4ge1xyXG4gICAgICByZXR1cm4gISEhZGF0YVxyXG4gICAgICAgID8gbnVsbFxyXG4gICAgICAgIDogZGF0YS5yZWR1Y2UoKGxpc3QsIGVudHJ5KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBjbG9uZSA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoZW50cnkpKSB7XHJcbiAgICAgICAgICAgICAgLy8gaWYgdGhlIG9iamVjdCBtYXRjaGVzIHRoZSBmaWx0ZXIsIGNsb25lIGl0IGFzIGl0IGlzXHJcbiAgICAgICAgICAgICAgY2xvbmUgPSBPYmplY3QuYXNzaWduKHt9LCBlbnRyeSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW50cnlbY2hpbGRLZXldICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAvLyBpZiB0aGUgb2JqZWN0IGhhcyBjaGlsZHJlbnMsIGZpbHRlciB0aGUgbGlzdCBvZiBjaGlsZHJlblxyXG4gICAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gZmlsdGVyRGF0YShlbnRyeVtjaGlsZEtleV0sIHByZWRpY2F0ZSk7XHJcbiAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIGFueSBvZiB0aGUgY2hpbGRyZW4gbWF0Y2hlcywgY2xvbmUgdGhlIHBhcmVudCBvYmplY3QsIG92ZXJ3cml0ZVxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIGNoaWxkcmVuIGxpc3Qgd2l0aCB0aGUgZmlsdGVyZWQgbGlzdFxyXG4gICAgICAgICAgICAgICAgY2xvbmUgPSBPYmplY3QuYXNzaWduKHt9LCBlbnRyeSwgeyBjaGlsZHJlbjogWy4uLmNoaWxkcmVuXSB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBjbG9uZWQgb2JqZWN0LCBwdXNoIGl0IHRvIHRoZSBvdXRwdXQgbGlzdFxyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXVudXNlZC1leHByZXNzaW9uXHJcbiAgICAgICAgICAgIGNsb25lICYmIGxpc3QucHVzaChjbG9uZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgICAgICAgfSwgW10pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmaWx0ZXJEYXRhKGFycmF5LCAoaXRlbSkgPT4ge1xyXG4gICAgICByZXR1cm4gKFxyXG4gICAgICAgIGl0ZW1bZmlsdGVyS2V5XSAmJlxyXG4gICAgICAgIGl0ZW1bZmlsdGVyS2V5XVxyXG4gICAgICAgICAgLnRvU3RyaW5nKClcclxuICAgICAgICAgIC50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAuaW5jbHVkZXModmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiBhcnJheTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVmFsdWUodjogc3RyaW5nKTogW3N0cmluZywgbnVtYmVyXSB7XHJcbiAgLy8gZXh0cmFjdCBudW1iZXIgKGRlZmF1bHRzIHRvIDAgaWYgbm90IHByZXNlbnQpXHJcbiAgY29uc3QgbiA9ICsodi5tYXRjaCgvXFxkKyQvKSB8fCBbMF0pWzBdO1xyXG4gIGNvbnN0IHN0ciA9IHYucmVwbGFjZShuLnRvU3RyaW5nKCksIFwiXCIpOyAvLyBleHRyYWN0IHN0cmluZyBwYXJ0XHJcbiAgcmV0dXJuIFtzdHIsIG5dO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc29ydChhcnJheTogYW55W10sIGtleTogc3RyaW5nLCBpc0NvbXBhcmUgPSBmYWxzZSk6IGFueVtdIHtcclxuICBjb25zdCBjb21wYXJlID0gKHg6IGFueSwgeTogYW55KSA9PiB7XHJcbiAgICBpZiAoaXNDb21wYXJlICYmIHR5cGVvZiB4ID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiB5ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIGNvbnN0IGEgPSBwYXJzZVZhbHVlKHgpO1xyXG4gICAgICBjb25zdCBiID0gcGFyc2VWYWx1ZSh5KTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYVswXS5sb2NhbGVDb21wYXJlKGJbMF0pO1xyXG4gICAgICByZXR1cm4gcmVzdWx0ID09PSAwID8gYVsxXSAtIGJbMV0gOiByZXN1bHQ7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB4ID09PSBcImJvb2xlYW5cIiAmJiB0eXBlb2YgeSA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgcmV0dXJuIHggJiYgIXkgPyAtMSA6IHggJiYgeSA/IDAgOiAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHggPCB5ID8gLTEgOiB4ID4geSA/IDEgOiAwO1xyXG4gIH07XHJcbiAgcmV0dXJuIGFycmF5LnNvcnQoKGEsIGIpID0+IHtcclxuICAgIGNvbnN0IHggPSBrZXlcclxuICAgICAgPyB0eXBlb2YgYVtrZXldID09PSBcInN0cmluZ1wiXHJcbiAgICAgICAgPyBhW2tleV0udG9Mb3dlckNhc2UoKVxyXG4gICAgICAgIDogYVtrZXldXHJcbiAgICAgIDogYTtcclxuICAgIGNvbnN0IHkgPSBrZXlcclxuICAgICAgPyB0eXBlb2YgYltrZXldID09PSBcInN0cmluZ1wiXHJcbiAgICAgICAgPyBiW2tleV0udG9Mb3dlckNhc2UoKVxyXG4gICAgICAgIDogYltrZXldXHJcbiAgICAgIDogYjtcclxuICAgIHJldHVybiBjb21wYXJlKHgsIHkpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbXVsdGlTb3J0KFxyXG4gIGFycmF5OiBhbnlbXSxcclxuICBrZXlzOiBzdHJpbmdbXSxcclxuICBpc0NvbXBhcmUgPSBmYWxzZVxyXG4pOiBhbnlbXSB7XHJcbiAgY29uc3QgY29tcGFyZSA9ICh4OiBhbnksIHk6IGFueSkgPT4ge1xyXG4gICAgaWYgKGlzQ29tcGFyZSAmJiB0eXBlb2YgeCA9PT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgeSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBjb25zdCBhID0gcGFyc2VWYWx1ZSh4KTtcclxuICAgICAgY29uc3QgYiA9IHBhcnNlVmFsdWUoeSk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGFbMF0ubG9jYWxlQ29tcGFyZShiWzBdKTtcclxuICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gMCA/IGFbMV0gLSBiWzFdIDogcmVzdWx0O1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgeCA9PT0gXCJib29sZWFuXCIgJiYgdHlwZW9mIHkgPT09IFwiYm9vbGVhblwiKSB7XHJcbiAgICAgIHJldHVybiB4ID09PSB5ID8gMCA6IHggPyAtMSA6IDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4geCA8IHkgPyAtMSA6IHggPiB5ID8gMSA6IDA7XHJcbiAgfTtcclxuICBsZXQgcmV0dXJuQXJyYXkgPSBhcnJheTtcclxuICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgcmV0dXJuQXJyYXkgPSByZXR1cm5BcnJheS5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGNvbnN0IHggPSB0eXBlb2YgYVtrZXldID09PSBcInN0cmluZ1wiID8gYVtrZXldLnRvTG93ZXJDYXNlKCkgOiBhW2tleV07XHJcbiAgICAgIGNvbnN0IHkgPSB0eXBlb2YgYltrZXldID09PSBcInN0cmluZ1wiID8gYltrZXldLnRvTG93ZXJDYXNlKCkgOiBiW2tleV07XHJcbiAgICAgIHJldHVybiBjb21wYXJlKHgsIHkpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIHJldHVybkFycmF5O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ3JvdXBCeShhcnJheTogYW55W10sIGtleXM6IFtzdHJpbmcsIHN0cmluZywgYW55XSk6IGFueVtdIHtcclxuICBjb25zdCBbcGFyZW50S2V5LCBjaGlsZEtleSwgc29ydEtleV0gPSBrZXlzO1xyXG4gIGxldCBwYXJlbnRMaXN0ID0gYXJyYXkuZmlsdGVyKChmKSA9PiAhZltwYXJlbnRLZXldKTtcclxuICBjb25zdCBjaGlsZExpc3QgPSBmaWx0ZXIoYXJyYXksIHBhcmVudEtleSk7XHJcbiAgcGFyZW50TGlzdC5mb3JFYWNoKChwYXJlbnQpID0+IHtcclxuICAgIGNvbnN0IGl0ZW1zID0gZmlsdGVyKGNoaWxkTGlzdCwgcGFyZW50S2V5LCBwYXJlbnRbY2hpbGRLZXldKTtcclxuICAgIGlmIChzb3J0S2V5KSB7XHJcbiAgICAgIGlmICh0eXBlb2Ygc29ydEtleSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIHBhcmVudC5pdGVtcyA9IHNvcnQoaXRlbXMsIHNvcnRLZXkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBhcmVudC5pdGVtcyA9IG11bHRpU29ydChpdGVtcywgc29ydEtleSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBhcmVudC5pdGVtcyA9IGl0ZW1zO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHBhcmVudExpc3QgPSBzb3J0S2V5ID8gc29ydChwYXJlbnRMaXN0LCBzb3J0S2V5KSA6IHBhcmVudExpc3Q7XHJcbiAgcmV0dXJuIFsuLi5wYXJlbnRMaXN0XTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJldHdlZW4odmFsdWU6IG51bWJlciwgbWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIHZhbHVlID49IG1pbiAmJiB2YWx1ZSA8PSBtYXg7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwZXJjZW50YWdlKHZhbHVlOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpOiBudW1iZXIge1xyXG4gIHJldHVybiBNYXRoLnJvdW5kKCh2YWx1ZSAqIDEwMCkgLyB0b3RhbCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0pzb24oc3RyOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICB0cnkge1xyXG4gICAgSlNPTi5wYXJzZShzdHIpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuIl19